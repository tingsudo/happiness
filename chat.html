<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with HerPower</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .chat-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            text-align: center;
            margin-bottom: 2rem;
            flex-shrink: 0;
        }

        .chat-header h1 {
            color: var(--accent-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .chat-messages {
            height: 150px;
            overflow-y: auto;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 10px;
            margin-bottom: 1rem;
            flex-grow: 1;
            transition: height 0.3s ease;
        }

        .chat-messages.expanded {
            height: calc(90vh - 250px);
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 10px;
            max-width: 80%;
        }

        .user-message {
            background: #FFE4E8;  /* Light pink background */
            color: #333;  /* Darker text color for better contrast */
            margin-left: auto;
        }

        .bot-message {
            background: #f0f0f0;
            color: var(--text-color);
        }

        .bot-message p {
            margin: 0.5em 0;
        }

        .bot-message ul, .bot-message ol {
            margin: 0.5em 0;
            padding-left: 1.5em;
        }

        .bot-message li {
            margin: 0.3em 0;
        }

        .bot-message code {
            background: rgba(0, 0, 0, 0.1);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: monospace;
        }

        .bot-message pre {
            background: rgba(0, 0, 0, 0.1);
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
        }

        .bot-message blockquote {
            border-left: 3px solid var(--accent-color);
            margin: 0.5em 0;
            padding-left: 1em;
            color: #666;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            flex-shrink: 0;
            margin-top: auto;
        }

        .chat-input input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .chat-input button {
            padding: 0.8rem 1.5rem;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .chat-input button:hover {
            background: var(--secondary-color);
        }

        @media (max-width: 768px) {
            .chat-container {
                margin: 1rem;
                padding: 0.5rem;
                min-height: 250px;
            }

            .chat-messages {
                height: 100px;
            }

            .chat-messages.expanded {
                height: calc(65vh - 120px);
            }

            .message {
                max-width: 90%;
            }
        }

        .disclaimer a {
            color: #d72660;
            font-weight: 600;
            text-decoration: underline;
        }
        .disclaimer a:hover {
            color: #a81c47;
        }

        .visitor-stats {
            background: #f8f9fa;
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .visitor-counter {
            flex: 0 0 200px;
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .visitor-counter h2 {
            color: var(--accent-color);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        #visitorCount {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .visitor-map {
            flex: 1;
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .visitor-map h2 {
            color: var(--accent-color);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        #map {
            height: 250px;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .stats-container {
                flex-direction: column;
                padding: 0 1rem;
            }

            .visitor-counter {
                flex: none;
                width: 100%;
            }

            #map {
                height: 180px;
            }
        }

        .bottom-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            max-width: 900px;
            margin: 2rem auto 0 auto;
            padding: 0 1rem;
        }
        .map-col {
            flex: 0 0 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 240px;
        }
        .map-wrapper {
            width: 220px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .carousel-col {
            flex: 1;
            display: flex;
            align-items: center;
            min-width: 0;
        }
        .testimonial-carousel {
            width: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 1.2rem 2.2rem;
            display: flex;
            align-items: center;
            position: relative;
            min-height: 120px;
        }
        .testimonial-content {
            flex: 1;
            text-align: left;
            font-size: 0.98rem;
            color: #222;
            font-family: 'Open Sans', sans-serif;
            height: 90px;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .testimonial-text {
            flex: 1;
            margin-bottom: 0.7rem;
            font-size: 0.85rem;
        }
        .testimonial-user {
            font-size: 0.85rem;
            color: #856404;
            font-weight: 600;
            letter-spacing: 0.01em;
        }
        .carousel-arrow {
            background: #fff3cd;
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: #d72660;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            margin: 0 0.5rem;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .carousel-arrow svg {
            width: 20px;
            height: 20px;
        }
        .carousel-arrow:hover {
            background: #ffeeba;
            color: #a81c47;
            box-shadow: 0 4px 12px rgba(215,38,96,0.12);
        }
        @media (max-width: 768px) {
            .bottom-row {
                flex-direction: column;
                gap: 1.5rem;
                max-width: 100%;
                margin-top: 1.5rem;
            }
            .map-col, .carousel-col {
                width: 100%;
                justify-content: center;
                align-items: center;
            }
            .map-wrapper {
                width: 90vw;
                max-width: 220px;
                height: 100px;
                margin: 0 auto;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .testimonial-carousel {
                padding: 1.5rem 1.1rem;
                min-height: 160px;
                max-width: 98vw;
                margin: 0 auto;
                box-sizing: border-box;
                border-radius: 30px;
            }
            .testimonial-content {
                width: 100%;
                box-sizing: border-box;
                padding: 0.2rem 0.2rem 0.2rem 0.2rem;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .carousel-arrow {
                margin: 0 0.2rem;
                min-width: 38px;
            }
            .testimonial-text {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }
        }
        /* Add a soft divider between map and carousel on mobile */
        @media (max-width: 768px) {
            .map-col {
                border-bottom: 1.5px solid #f3e6e6;
                padding-bottom: 1.2rem;
                margin-bottom: 0.5rem;
            }
        }
        .map-bg {
            background: white;
            border-radius: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 280px;
            height: 180px;
            margin: 0 auto;
        }
        @media (max-width: 768px) {
            .map-col {
                height: 180px;
            }
            .map-bg {
                width: 98vw;
                max-width: 320px;
                height: 140px;
                padding: 0;
            }
            .map-wrapper {
                width: 180px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="resources/logo.avif" alt="HerPower Logo">
            </div>
            <ul>
                <li><a href="index.html">Home</a></li>
            </ul>
        </nav>
    </header>

    <main class="chat-container">
        <div class="chat-header">
            <h1>Chat with HerPower Coach</h1>
            <p>I'm here to help improve  communication between parents and teens. </p>
        </div>

        <div class="disclaimer" id="disclaimerBox" style="background-color: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #ffeeba;">
            <div id="disclaimerToggle" style="cursor:pointer; font-weight:600; display:flex; align-items:center; min-height: 1.5em; font-size:0.85rem;">
                <span id="disclaimerToggleText">Show Disclaimer</span>
                <span id="disclaimerArrow" style="margin-left:8px;">▼</span>
            </div>
            <div id="disclaimerContent" style="display:none; margin-top:0.5rem; font-size: 0.9rem; line-height: 1.5; padding: 0;"></div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                Hello! I'm your communication coach, here to help improve understanding between parents and teens. How can I assist you today?
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Type your message here..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </main>

    <!-- Bottom section: Map + Testimonial Carousel -->
    <section class="bottom-row">
        <div class="map-col">
            <div class="map-bg">
                <div class="map-wrapper">
                    <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=a&t=tt&d=HLXiGM_fUthMYdTqGzU3uh_oAH1cO2od2zWRfKNZz3U&co=dba251&cmn=000000&cmo=c931bc'></script>
                </div>
            </div>
        </div>
        <div class="carousel-col">
            <div class="testimonial-carousel" id="testimonialCarousel">
                <button class="carousel-arrow left" id="carouselPrev">&#8592;</button>
                <div class="testimonial-content" id="testimonialContent">
                    <!-- Testimonials will be injected here -->
                </div>
                <button class="carousel-arrow right" id="carouselNext">&#8594;</button>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 HerPower. All Rights Reserved.</p>
        </div>
    </footer>

    <a href="#" class="scroll-to-top" id="scrollTop" title="Scroll to Top" style="background-color: black; color: white; position: fixed; bottom: 40px; right: 40px; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 24px; z-index: 9999;">
        ↑
    </a>


    <script>
        // Azure ChatGPT API configuration
        const API_ENDPOINT = 'https://xplority-bot-api-mgr.azure-api.net/chatbot/chat/completions';
        const SUBSCRIPTION_KEY = '16d59b92925c409daaeef45e3e7315e5';

        // Store conversation history
        let conversationHistory = [
            {
                role: "system",
                content: "You are a compassionate and emotionally intelligent AI conversation coach. Your role is to support and guide positive communication between parents and their teenage children. You help them understand each other's perspectives, express their feelings constructively, and find common ground. Your responses should reduce tension, prevent conflict, and foster mutual respect and empathy.\n\nUse the following principles:\n\nBe neutral, never take sides.\n\nEncourage both parties to listen and validate each other's feelings.\n\nUse simple, respectful language suitable for both teenagers and adults.\n\nOffer conversation tips, reflection prompts, and rephrasing suggestions.\n\nPromote curiosity over judgment, and cooperation over control.\n\nHelp reframe negative emotions into constructive dialogue.\n\nSuggest pauses, empathy-building activities, or breaks if the conversation escalates.\n\nAlways aim to build trust, emotional safety, and effective collaboration."
            }
        ];
        // Function to expand chat messages area
        function expandChatMessages() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.classList.add('expanded');
        }

        // Scroll to top functionality
        document.getElementById("scrollTop").addEventListener("click", function(e) {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        });

        // Chat functionality
        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message) {
                // Add user message
                addMessage(message, 'user');
                
                // Add user message to conversation history
                conversationHistory.push({
                    role: "user",
                    content: message
                });
                
                // Clear input
                userInput.value = '';
                
                try {
                    // Show loading message
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'message bot-message';
                    loadingDiv.textContent = 'Thinking...';
                    document.getElementById('chatMessages').appendChild(loadingDiv);

                    // Call Azure ChatGPT API with conversation history
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Ocp-Apim-Subscription-Key': SUBSCRIPTION_KEY
                        },
                        credentials: 'omit',
                        body: JSON.stringify({
                            messages: conversationHistory
                        })
                    });

                    // Remove loading message
                    loadingDiv.remove();

                    if (!response.ok) {
                        const errorData = await response.text();
                        console.error('API Error:', errorData);
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const data = await response.json();
                    const botResponse = data.choices[0].message.content;
                    
                    // Add bot response to conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: botResponse
                    });
                    
                    addMessage(botResponse, 'bot');
                    
                    // Expand chat messages area after receiving response
                    expandChatMessages();

                } catch (error) {
                    console.error('Error:', error);
                    // Remove loading message if it exists
                    const loadingDiv = document.querySelector('.message.bot-message:last-child');
                    if (loadingDiv && loadingDiv.textContent === 'Thinking...') {
                        loadingDiv.remove();
                    }
                    
                    // Show user-friendly error message
                    addMessage('I apologize, but I\'m having trouble connecting right now. This might be due to network issues or server maintenance. Please try again in a few moments.', 'bot');
                    
                    // Expand chat messages area even for error messages
                    expandChatMessages();
                }
            }
        }

        function addMessage(text, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'bot') {
                // Parse markdown for bot messages
                messageDiv.innerHTML = marked.parse(text);
            } else {
                // Keep user messages as plain text
                messageDiv.textContent = text;
            }
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Allow sending message with Enter key
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Collapsible disclaimer functionality
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('disclaimerToggle');
            const content = document.getElementById('disclaimerContent');
            const toggleText = document.getElementById('disclaimerToggleText');
            const arrow = document.getElementById('disclaimerArrow');
            let expanded = false;
            // Set the disclaimer text only when expanded
            const disclaimerHTML = `<strong>Disclaimer:</strong> This chatbot is for general communication guidance and emotional support only. It is not a substitute for professional medical, mental health, or legal advice. If you are experiencing distress or need professional help, please consult a licensed expert. If you encounter any issues or bugs, please report them via our <a href='https://www.herpowercanada.org/joinus' target='_blank' rel='noopener noreferrer'>contact page</a> — we appreciate your feedback!`;
            toggle.addEventListener('click', function() {
                expanded = !expanded;
                if (expanded) {
                    content.innerHTML = disclaimerHTML;
                    content.style.display = 'block';
                } else {
                    content.innerHTML = '';
                    content.style.display = 'none';
                }
                toggleText.textContent = expanded ? 'Hide Disclaimer' : 'Show Disclaimer';
                arrow.textContent = expanded ? '▲' : '▼';
            });
        });

        // Testimonial carousel logic
        const testimonials = [
            {
                text: "As a mom, HerPower Communication Coach helped me finally have a calm, meaningful conversation with my child about screen time. It gave me the right words and approach to connect with my kid in a way that felt respectful and effective.",
                user: "Tina L., Parent of Teen"
            },
            {
                text: "I was struggling to talk to my teen about school stress. The coach's tips made our talks less tense and more productive. Highly recommend!",
                user: "James W., Father of Two"
            },
            {
                text: "This chatbot gave me practical ways to listen to my daughter and made our relationship stronger.",
                user: "Vivian S., Mom of a 15-year-old"
            }
        ];
        let currentTestimonial = 0;
        function showTestimonial(idx) {
            const content = document.getElementById('testimonialContent');
            content.innerHTML = `
                <div class="testimonial-text">${testimonials[idx].text}</div>
                <div class="testimonial-user">${testimonials[idx].user}</div>
            `;
        }
        document.addEventListener('DOMContentLoaded', function() {
            showTestimonial(currentTestimonial);
            document.getElementById('carouselPrev').innerHTML = '<svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>';
            document.getElementById('carouselNext').innerHTML = '<svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>';
            document.getElementById('carouselPrev').onclick = function() {
                currentTestimonial = (currentTestimonial - 1 + testimonials.length) % testimonials.length;
                showTestimonial(currentTestimonial);
            };
            document.getElementById('carouselNext').onclick = function() {
                currentTestimonial = (currentTestimonial + 1) % testimonials.length;
                showTestimonial(currentTestimonial);
            };
            setInterval(function() {
                currentTestimonial = (currentTestimonial + 1) % testimonials.length;
                showTestimonial(currentTestimonial);
            }, 8000);
        });
    </script>
</body>
</html> 